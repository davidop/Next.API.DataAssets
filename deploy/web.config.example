<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <!--
    ============================================================================
    EJEMPLO COMPLETO de web.config con API Key CONFIGURADA
    ============================================================================
    
    Este es un ejemplo listo para usar con la API Key:
    AGdJ4tivFc0Ljzh3ebMQ5gXZkDnfulSH
    
    INSTRUCCIONES:
    1. Copia este archivo a tu servidor IIS como "web.config"
    2. Ajusta las rutas y configuraciones según necesites
    3. Reinicia el Application Pool: Restart-WebAppPool -Name "DataAssetsAppPool"
    4. Testea con Postman usando el header: X-API-Key: AGdJ4tivFc0Ljzh3ebMQ5gXZkDnfulSH
    
    ============================================================================
  -->
  <system.webServer>
    <handlers>
      <add name="aspNetCore" path="*" verb="*" modules="AspNetCoreModuleV2" resourceType="Unspecified"/>
    </handlers>
    
    <!-- 
      HOSTING MODEL:
      - outofprocess: Máxima compatibilidad (Windows Server 2012 R2+)
      - inprocess: Mejor rendimiento (Windows Server 2019+)
    -->
    <aspNetCore processPath="dotnet" 
                arguments="Next.API.DataAssets.dll" 
                stdoutLogEnabled="false" 
                stdoutLogFile=".\logs\stdout" 
                hostingModel="outofprocess">
      
      <environmentVariables>
        <!-- ============================================================ -->
        <!-- ENVIRONMENT                                                  -->
        <!-- ============================================================ -->
        <environmentVariable name="ASPNETCORE_ENVIRONMENT" value="Production" />
        
        <!-- ============================================================ -->
        <!-- ASSETS CONFIGURATION                                         -->
        <!-- ============================================================ -->
        <environmentVariable name="Assets__RootPath" value="assets" />
        <environmentVariable name="Assets__DefaultCacheSeconds" value="600" />
        
        <!-- ============================================================ -->
        <!-- HEALTH CHECK                                                 -->
        <!-- ============================================================ -->
        <environmentVariable name="Health__AllowAnonymous" value="false" />
        
        <!-- ============================================================ -->
        <!-- API KEY AUTHENTICATION                                       -->
        <!-- ============================================================ -->
        <environmentVariable name="Auth__ApiKeysOptions__HeaderName" value="X-API-Key" />
        
        <!-- API Key #1: Production Client 1 -->
        <!-- Raw Key: AGdJ4tivFc0Ljzh3ebMQ5gXZkDnfulSH (Give this to client) -->
        <environmentVariable name="Auth__ApiKeysOptions__Keys__0__KeyId" value="production-client-1" />
        <environmentVariable name="Auth__ApiKeysOptions__Keys__0__Owner" value="Production Client 1" />
        <environmentVariable name="Auth__ApiKeysOptions__Keys__0__KeyHash" value="f34270a335b52d33de7c3b04da14f2fb1ffee7e1c10247984287ebe4e9e364ab" />
        <environmentVariable name="Auth__ApiKeysOptions__Keys__0__Enabled" value="true" />
        
        <!-- API Key #2: Example for multiple clients -->
        <!-- Generate new keys with: .\Generate-ApiKey.ps1 -->
        <!--
        <environmentVariable name="Auth__ApiKeysOptions__Keys__1__KeyId" value="production-client-2" />
        <environmentVariable name="Auth__ApiKeysOptions__Keys__1__Owner" value="Production Client 2" />
        <environmentVariable name="Auth__ApiKeysOptions__Keys__1__KeyHash" value="your-second-client-hash-here" />
        <environmentVariable name="Auth__ApiKeysOptions__Keys__1__Enabled" value="true" />
        -->
        
        <!-- ============================================================ -->
        <!-- JWT AUTHENTICATION (Optional)                                -->
        <!-- ============================================================ -->
        <environmentVariable name="Auth__Jwt__Issuer" value="your-company-name" />
        <environmentVariable name="Auth__Jwt__Audience" value="dataassets-api" />
        <environmentVariable name="Auth__Jwt__SigningKey" value="CHANGE-THIS-TO-A-SECURE-KEY-MINIMUM-32-CHARACTERS-LONG" />
        <environmentVariable name="Auth__Jwt__ValidateIssuer" value="true" />
        <environmentVariable name="Auth__Jwt__ValidateAudience" value="true" />
        <environmentVariable name="Auth__Jwt__ClockSkewSeconds" value="30" />
        
        <!-- ============================================================ -->
        <!-- RATE LIMITING                                                -->
        <!-- ============================================================ -->
        <environmentVariable name="RateLimiting__IpRateLimitOptions__EnableEndpointRateLimiting" value="true" />
        <environmentVariable name="RateLimiting__IpRateLimitOptions__StackBlockedRequests" value="false" />
        <environmentVariable name="RateLimiting__IpRateLimitOptions__RealIpHeader" value="X-Real-IP" />
        <environmentVariable name="RateLimiting__IpRateLimitOptions__ClientIdHeader" value="X-ClientId" />
        <environmentVariable name="RateLimiting__IpRateLimitOptions__HttpStatusCode" value="429" />
        
        <!-- Rate Limit Rules -->
        <environmentVariable name="RateLimiting__IpRateLimitOptions__GeneralRules__0__Endpoint" value="*:/resources/*" />
        <environmentVariable name="RateLimiting__IpRateLimitOptions__GeneralRules__0__Period" value="1m" />
        <environmentVariable name="RateLimiting__IpRateLimitOptions__GeneralRules__0__Limit" value="60" />
        
      </environmentVariables>
      
    </aspNetCore>
    
  </system.webServer>
</configuration>
